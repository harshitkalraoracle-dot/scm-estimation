<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SCM Estimation Catalog v1.4</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --overview-bg: #e3f2fd;
  --feature-bg: #f3e5f5;
  --personalization-bg: #e8f5e9;
  --grand-bg: #fce4ec;
}

body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: #fafafa;
  margin: 20px;
  color: #333;
}

h1 {
  text-align: center;
  color: #1a237e;
}

.subtitle {
  text-align: center;
  color: #555;
  margin-bottom: 24px;
}

.section {
  margin-bottom: 30px;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.section.overview { background: var(--overview-bg); }
.section.features { background: var(--feature-bg); }
.section.personalization { background: var(--personalization-bg); }

.section-header {
  padding: 12px 16px;
  font-weight: 600;
  background: rgba(255,255,255,0.8);
  border-bottom: 1px solid #ccc;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: center;
  vertical-align: top;
}

th {
  background: #bbdefb;
  font-weight: 600;
}

td:first-child {
  text-align: left;
}

input[type="number"] {
  width: 90px;
  padding: 6px;
  font-size: 14px;
}

textarea {
  width: 100%;
  min-height: 48px;
  resize: vertical;
  padding: 6px;
  font-size: 13px;
}

.totals td {
  font-weight: bold;
  background: #e0e0e0;
}

.grand-total {
  background: var(--grand-bg);
}

button {
  display: block;
  margin: 30px auto;
  padding: 12px 32px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  background: #4caf50;
  color: white;
  cursor: pointer;
}
button:hover {
  background: #388e3c;
}
</style>
</head>

<body>

<h1>SCM Estimation Catalog (v1.4)</h1>
<p class="subtitle">Enter quantity first, then hours. Comments are optional.</p>

<div id="formContainer"></div>

<button onclick="downloadXLSX()">ðŸ“¥ Download as Excel (.xlsx)</button>

<script>
const template = [
  {
    section: "Overview",
    class: "overview",
    tasks: [
      { name: "Discussion", nonProd: 8, prod: 8, qty: 1, comment: "" },
      { name: "Documentation", nonProd: 16, prod: 16, qty: 1, comment: "" },
      { name: "Demo / Review", nonProd: 8, prod: 8, qty: 1, comment: "" }
    ]
  },
  {
    section: "Enablement of Applicable Features",
    class: "features",
    tasks: [
      { name: "Features Enablement", nonProd: 0.1, prod: 0.1, qty: 0, comment: "" },
      { name: "Config Verification", nonProd: 0.1, prod: 0.1, qty: 0, comment: "" },
      { name: "UI Verification", nonProd: 8, prod: 8, qty: 0, comment: "" },
      { name: "Unit Testing (No Personalization)", nonProd: 32, prod: 0, qty: 0, comment: "" }
    ]
  },
  {
    section: "Personalization & Production Migration",
    class: "personalization",
    tasks: [
      { name: "Enablement & Migration", nonProd: 1, prod: 0.1, qty: 32, comment: "" },
      { name: "Testing After Personalization", nonProd: 40, prod: 0, qty: 1, comment: "" },
      { name: "Issue Resolution (UAT / Post Go-Live)", nonProd: 0, prod: 4, qty: 3, comment: "" }
    ]
  }
];

function renderForm() {
  const container = document.getElementById("formContainer");
  container.innerHTML = "";

  let gNP = 0, gP = 0, gT = 0, gC = 0;

  template.forEach((sec, sIdx) => {
    const div = document.createElement("div");
    div.className = `section ${sec.class}`;

    let rows = "";
    let sNP = 0, sP = 0, sT = 0, sC = 0;

    sec.tasks.forEach((t, tIdx) => {
      const total = (t.nonProd + t.prod) * t.qty;
      const csu = total / 2;

      sNP += t.nonProd * t.qty;
      sP += t.prod * t.qty;
      sT += total;
      sC += csu;

      rows += `
        <tr>
          <td>${t.name}</td>
          <td><input type="number" min="0" value="${t.qty}"
            onchange="update(${sIdx},${tIdx},'qty',this.value)"></td>
          <td><input type="number" step="0.1" value="${t.nonProd}"
            onchange="update(${sIdx},${tIdx},'nonProd',this.value)"></td>
          <td><input type="number" step="0.1" value="${t.prod}"
            onchange="update(${sIdx},${tIdx},'prod',this.value)"></td>
          <td>${total.toFixed(1)}</td>
          <td>${csu.toFixed(1)}</td>
          <td>
            <textarea placeholder="Optional notes..."
              onchange="update(${sIdx},${tIdx},'comment',this.value)">${t.comment}</textarea>
          </td>
        </tr>`;
    });

    gNP += sNP; gP += sP; gT += sT; gC += sC;

    div.innerHTML = `
      <div class="section-header">${sec.section}</div>
      <table>
        <thead>
          <tr>
            <th>Task</th>
            <th>Qty</th>
            <th>Non-Prod Hrs</th>
            <th>Prod Hrs</th>
            <th>Total Hrs</th>
            <th>CSUs</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody>
          ${rows}
          <tr class="totals">
            <td>Section Total</td>
            <td></td>
            <td>${sNP.toFixed(1)}</td>
            <td>${sP.toFixed(1)}</td>
            <td>${sT.toFixed(1)}</td>
            <td>${sC.toFixed(1)}</td>
            <td></td>
          </tr>
        </tbody>
      </table>`;
    container.appendChild(div);
  });

  const g = document.createElement("div");
  g.className = "section grand-total";
  g.innerHTML = `
    <div class="section-header">Grand Total</div>
    <table>
      <tr class="totals">
        <td>Total</td>
        <td></td>
        <td>${gNP.toFixed(1)}</td>
        <td>${gP.toFixed(1)}</td>
        <td>${gT.toFixed(1)}</td>
        <td>${gC.toFixed(1)}</td>
        <td></td>
      </tr>
    </table>`;
  container.appendChild(g);
}

function update(s, t, key, value) {
  template[s].tasks[t][key] =
    key === "comment" ? value : Number(value) || 0;
  renderForm();
}

function downloadXLSX() {
  const data = [["Section","Task","Qty","NonProd","Prod","Total","CSUs","Comment"]];
  template.forEach(s =>
    s.tasks.forEach(t => {
      const total = (t.nonProd + t.prod) * t.qty;
      data.push([s.section,t.name,t.qty,t.nonProd,t.prod,total,total/2,t.comment]);
    })
  );
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, "Estimation");
  XLSX.writeFile(wb, "SCM_Estimation_Catalog.xlsx");
}

renderForm();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Redwood Adoption Estimator (Final)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --overview-bg:#e3f2fd;
  --product-bg:#fff3e0;
  --hypercare-bg:#f3e5f5;
  --grand-bg:#fce4ec;
}
body {
  font-family:'Segoe UI',Tahoma,sans-serif;
  background:#f5f7fa;
  margin:0;
}
.header {
  background:#1a73e8;
  color:#fff;
  padding:16px 20px;
}
.dashboard {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
  padding:16px;
  background:#fff;
}
.tabs {
  display:flex;
  background:#f1f3f5;
  padding:0 20px;
  border-bottom:1px solid #ddd;
}
.tab {
  padding:12px 20px;
  cursor:pointer;
  font-weight:600;
}
.tab.active {
  color:#1a73e8;
  border-bottom:3px solid #1a73e8;
}
.tab-content {
  display:none;
  padding:20px;
}
.tab-content.active { display:block; }

.section {
  margin-bottom:24px;
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 1px 4px rgba(0,0,0,0.08);
}
.section-header {
  padding:10px 16px;
  font-weight:bold;
  background:rgba(255,255,255,0.9);
  border-bottom:1px solid #ccc;
}
table {
  width:100%;
  border-collapse:collapse;
}
th,td {
  padding:8px;
  border:1px solid #ddd;
  text-align:center;
}
th { background:#f5f9ff; }
td.task-name { text-align:left; font-weight:bold; }
td.task-details { text-align:left; }
input[type="number"] {
  width:80px;
  padding:4px;
  text-align:center;
}
button.download {
  margin:24px auto;
  display:block;
  padding:12px 28px;
  background:#4caf50;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
  <h2>Redwood Adoption Estimator</h2>
</div>

<div class="dashboard">
  <div>
    <label>Customer Name</label>
    <input id="customerName" value="Global Enterprises"/>
  </div>
  <div>
    <label>Modules Selected</label>
    <input id="moduleCount" readonly/>
  </div>
  <div>
    <label>Products Selected</label>
    <input id="productCount" readonly/>
  </div>
</div>

<div class="tabs">
  <div class="tab active" data-tab="selector">1. Selector</div>
  <div class="tab" data-tab="estimation">2. Estimation</div>
  <div class="tab" onclick="checkAdminPassword()">3. ðŸ”’ Admin</div>
</div>

<div id="selector" class="tab-content active">
  <div id="productContainer"></div>
</div>

<div id="estimation" class="tab-content">
  <div id="formContainer"></div>
  <button class="download" onclick="downloadAll()">ðŸ“¥ Download Full Estimation</button>
</div>

<div id="admin" class="tab-content">
  <div id="adminContainer"></div>
  <button class="download" onclick="downloadAll()">ðŸ“¥ Download Full Estimation</button>
</div>

<script>
/* =========================
   MASTER DATA
========================= */

const PRODUCTS = [
  { name: "SCM Common Components", weight: 0.5 },
  { name: "Inventory Management", weight: 1.2 },
  { name: "Maintenance", weight: 1.2 },
  { name: "Manufacturing", weight: 1.5 },
  { name: "Order Management", weight: 1.0 },
  { name: "Collaboration Messaging Framework", weight: 1.0 },
  { name: "Procurement", weight: 1.0 },
  { name: "Product Hub", weight: 1.0 },
  { name: "Purchasing", weight: 1.0 },
  { name: "Quality Management", weight: 1.1 },
  { name: "Self Service Procurement & RSSP", weight: 1.0 },
  { name: "Supply Chain Collaboration", weight: 1.0 },
  { name: "Supply Chain Orchestration", weight: 1.1 },
  { name: "Supply Chain Planning", weight: 1.2 }
];

const MODULES = [
  { name: "SCM Common Components", count: 1, product: "SCM Common Components" },
  { name: "Configuration and Extensibility", count: 1, product: "SCM Common Components" },
  { name: "Journeys", count: 3, product: "SCM Common Components" },
  { name: "Advanced Inventory Management", count: 8, product: "Inventory Management" },
  { name: "Configure to order", count: 1, product: "Inventory Management" },
  { name: "Cost Management", count: 43, product: "Inventory Management" },
  { name: "E-signatures & E- records", count: 2, product: "Inventory Management" },
  { name: "Fiscal Document Capture", count: 5, product: "Inventory Management" },
  { name: "Intrastat", count: 2, product: "Inventory Management" },
  { name: "Inventory Management", count: 68, product: "Inventory Management" },
  { name: "Land Cost Management", count: 12, product: "Inventory Management" },
  { name: "Mobile Inventory", count: 18, product: "Inventory Management" },
  { name: "Product Recall Management", count: 1, product: "Inventory Management" },
  { name: "Receipt Accounting", count: 6, product: "Inventory Management" },
  { name: "Receiving", count: 25, product: "Inventory Management" },
  { name: "Shipping", count: 14, product: "Inventory Management" },
  { name: "Supply Chain Financial Orchestration", count: 8, product: "Inventory Management" },
  { name: "Maintenance", count: 22, product: "Maintenance" },
  { name: "Service Logistics", count: 11, product: "Maintenance" },
  { name: "Flow Manufacturing", count: 7, product: "Manufacturing" },
  { name: "Kanban", count: 3, product: "Manufacturing" },
  { name: "Manufacturing", count: 38, product: "Manufacturing" },
  { name: "Smart Operations", count: 36, product: "Manufacturing" },
  { name: "Channel Revenue Management", count: 9, product: "Order Management" },
  { name: "Configration", count: 3, product: "Order Management" },
  { name: "Global Order Promising", count: 13, product: "Order Management" },
  { name: "Order Management", count: 26, product: "Order Management" },
  { name: "Pricing", count: 18, product: "Order Management" },
  { name: "Collaboration Messaging Framework", count: 19, product: "Collaboration Messaging Framework" },
  { name: "Common Procurement", count: 3, product: "Procurement" },
  { name: "External Purchase Prices", count: 3, product: "Procurement" },
  { name: "Procurement Contracts", count: 2, product: "Procurement" },
  { name: "Sourcing", count: 38, product: "Procurement" },
  { name: "Spend Classification", count: 2, product: "Procurement" },
  { name: "SQM", count: 4, product: "Procurement" },
  { name: "Supplier Model", count: 14, product: "Procurement" },
  { name: "Supplier Portal", count: 3, product: "Procurement" },
  { name: "Supplier Qualification Management", count: 6, product: "Procurement" },
  { name: "Product Management", count: 15, product: "Product Hub" },
  { name: "Product Development", count: 7, product: "Product Hub" },
  { name: "Product Development & Product Hub Common", count: 2, product: "Product Hub" },
  { name: "Product Hub", count: 3, product: "Product Hub" },
  { name: "Product Lifecycle Management Common", count: 3, product: "Product Hub" },
  { name: "Purchasing", count: 65, product: "Purchasing" },
  { name: "Quality Inspection Management", count: 11, product: "Quality Management" },
  { name: "Redwood Self Service Procurement", count: 75, product: "Self Service Procurement & RSSP" },
  { name: "Self Service Procurement", count: 3, product: "Self Service Procurement & RSSP" },
  { name: "Responsive Self Service Procurement", count: 32, product: "Self Service Procurement & RSSP" },
  { name: "Supply Chain Collaboration", count: 12, product: "Supply Chain Collaboration" },
  { name: "Supply Chain Orchestration", count: 25, product: "Supply Chain Orchestration" },
  { name: "Backlog Management", count: 5, product: "Supply Chain Planning" },
  { name: "Demand Management", count: 34, product: "Supply Chain Planning" },
  { name: "Replenishment Planning", count: 40, product: "Supply Chain Planning" },
  { name: "Sales and Operations Planning", count: 39, product: "Supply Chain Planning" },
  { name: "Supply Planning", count: 57, product: "Supply Chain Planning" }
];

/* =========================
   SINGLE SOURCE OF TRUTH
========================= */

let personalizationCounts = {};
let selectedModules = new Set();

const DEFAULT_OVERVIEW = [
  { name:"Discussion", detail:"Muliple Discussions with Customer educating on Redwood Process", nonProd:4, prod:4, qty:1 },
  { name:"Documentation", detail:"CWB's , Impact Assessment Document , Adoption Document", nonProd:8, prod:8, qty:1 },
  { name:"Demo / Review", detail:"Walk Through of Feature Before and After Adoption", nonProd:4, prod:4, qty:1 }
];

const DEFAULT_HYPERCARE = [
  { name:"Production Migration", detail:"Per personalization time / Env", nonProd:0, prod:0.5, qty:0 },
  { name:"Issue Resolution", detail:"This can Vary with reported issue / Env", nonProd:0, prod:4, qty:0 }
];

let CONFIG = {
  overview: structuredClone(DEFAULT_OVERVIEW),
  products: {}, // will hold per-product task lists
  hypercare: structuredClone(DEFAULT_HYPERCARE)
};

/* =========================
   TAB HANDLING
========================= */

document.querySelectorAll('.tab[data-tab]').forEach(t=>{
  t.onclick=()=>activateTab(t.dataset.tab);
});

function activateTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  if(document.querySelector(`.tab[data-tab="${id}"]`))
    document.querySelector(`.tab[data-tab="${id}"]`).classList.add('active');
  document.getElementById(id).classList.add('active');
}

/* =========================
   RENDERING CORE
========================= */

function renderSection(parent,title,tasks,editable){
  if(tasks.length===0) return;
  const sec=document.createElement("div");
  sec.className="section";
  sec.innerHTML=`<div class="section-header">${title}</div>`;

  let rows="";
  tasks.forEach((t,i)=>{
    const total=(t.nonProd+t.prod)*t.qty;
    rows+=`
    <tr>
      <td class="task-name">${t.name}</td>
      <td class="task-details">${t.detail}</td>
      <td>${editable?`<input type="number" step="0.1" value="${t.nonProd}" oninput="updateTask('${title}',${i},'nonProd',this.value)">`:t.nonProd.toFixed(1)}</td>
      <td>${editable?`<input type="number" step="0.1" value="${t.prod}" oninput="updateTask('${title}',${i},'prod',this.value)">`:t.prod.toFixed(1)}</td>
      <td>${editable?`<input type="number" value="${t.qty}" oninput="updateTask('${title}',${i},'qty',this.value)">`:t.qty}</td>
      <td>${total.toFixed(1)}</td>
      <td>${(total/2).toFixed(1)}</td>
    </tr>`;
  });

  sec.innerHTML+=`
  <table>
    <thead>
      <tr>
        <th>Task</th>
        <th>Details</th>
        <th>Non-Prod</th>
        <th>Prod</th>
        <th>Qty</th>
        <th>Total</th>
        <th>CSU</th>
      </tr>
    </thead>
    <tbody>${rows}</tbody>
  </table>`;
  parent.appendChild(sec);
}

/* =========================
   MODULE SELECTION
========================= */

function renderSelector(){
  const container = document.getElementById('productContainer');
  container.innerHTML = '';
  updateSummary();

  PRODUCTS.forEach(product => {
    const productDiv = document.createElement('div');
    productDiv.className = 'section';

    const modulesInProduct = MODULES.filter(m => m.product === product.name);
    let productModuleCount = 0;
    modulesInProduct.forEach(m => {
      if (selectedModules.has(m.name)) productModuleCount++;
    });

    if (!personalizationCounts[product.name]) {
      personalizationCounts[product.name] = 5;
    }

    productDiv.innerHTML = `
      <div class="section-header">${product.name} (Weight: ${product.weight})</div>
      <div style="padding:0 16px 10px;">
        <label>Personalizations: 
          <input type="number" min="0" value="${personalizationCounts[product.name]}" 
            oninput="updatePersonalization('${product.name}', this.value)">
        </label>
      </div>
      <table>
        <thead><tr><th>Module</th><th>Features</th><th>?</th></tr></thead>
        <tbody id="mods_${product.name.replace(/\s+/g, '_')}"></tbody>
      </table>`;
    container.appendChild(productDiv);

    const tbody = document.getElementById(`mods_${product.name.replace(/\s+/g, '_')}`);
    modulesInProduct.forEach(mod => {
      const isSelected = selectedModules.has(mod.name);
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${mod.name}</td>
        <td>${mod.count}</td>
        <td><button style="padding:2px 8px;border:none;border-radius:12px;background:${isSelected?'#e6f4ea':'#fce8e6'};color:${isSelected?'#137333':'#c5221f'};cursor:pointer;" 
          onclick="toggleModule('${mod.name}')">
          ${isSelected ? 'Y' : 'N'}
        </button></td>`;
      tbody.appendChild(row);
    });
  });
}

function toggleModule(moduleName) {
  if (selectedModules.has(moduleName)) {
    selectedModules.delete(moduleName);
  } else {
    selectedModules.add(moduleName);
  }
  renderSelector();
  rebuildProductConfig();
  renderEstimation();
}

function updatePersonalization(productName, value) {
  personalizationCounts[productName] = parseInt(value) || 0;
  rebuildProductConfig();
  renderEstimation();
}

function updateSummary() {
  document.getElementById('moduleCount').value = selectedModules.size;
  const selectedProducts = new Set();
  selectedModules.forEach(name => {
    const mod = MODULES.find(m => m.name === name);
    if (mod) selectedProducts.add(mod.product);
  });
  document.getElementById('productCount').value = selectedProducts.size;
}

/* =========================
   REBUILD PRODUCT CONFIG
========================= */

function rebuildProductConfig(){
  CONFIG.products = {};

  const selectedProducts = new Set();
  selectedModules.forEach(name => {
    const mod = MODULES.find(m => m.name === name);
    if (mod) selectedProducts.add(mod.product);
  });

  selectedProducts.forEach(productName => {
    const product = PRODUCTS.find(p => p.name === productName);
    let featureCount = 0;
    MODULES.filter(m => m.product === productName).forEach(m => {
      if (selectedModules.has(m.name)) featureCount += m.count;
    });
    const persCount = personalizationCounts[productName] || 0;

    CONFIG.products[productName] = [
      // Enablement
      { name: "Features Enablement", detail: "Enabling Feature by Feature by setup , Profile option , Opt-in Enablement.", nonProd: 0.1, prod: 0.1, qty: featureCount },
      { name: "Verification of Enabled Features at Config Level", detail: "Once All the features are enabled , verifed all features enablment.", nonProd: 0.1, prod: 0.1, qty: featureCount },
      { name: "Verification of Enabled Features at UI", detail: "Verification of enabled functionality by going into respective UI once all the features a enabled.", nonProd: 8 * product.weight, prod: 8 * product.weight, qty: 1 },
      { name: "Unit Testing w/o Personlization", detail: "Testing of Std Process by creating transaction.", nonProd: 24 * product.weight, prod: 0, qty: 1 },
      { name: "Comparision between Classic vs Redwood - W.O", detail: "Column by Column comparision between Classic and Redwood to ensure everything is covered.", nonProd: 16 * product.weight, prod: 0, qty: 1 },
      // Personalization
      { name: "Enablement of Personlization and Production Migration", detail: "This is per Personlization time / Env", nonProd: 2, prod: 1, qty: persCount },
      { name: "Testing After Personlizations", detail: "This can Vary with no.of Features and business process and Complexity", nonProd: 40, prod: 0, qty: persCount > 0 ? 1 : 0 }
    ];
  });

  // Update Hypercare
  let totalPers = 0;
  selectedProducts.forEach(p => { totalPers += personalizationCounts[p] || 0; });
  CONFIG.hypercare[0].qty = totalPers;
  CONFIG.hypercare[1].qty = Math.max(3, Math.ceil(totalPers * 0.2));
}

/* =========================
   ESTIMATION VIEW
========================= */

function renderEstimation(){
  const c=document.getElementById("formContainer");
  c.innerHTML="";
  renderSection(c,"Overview",CONFIG.overview,false);

  // Per-Product sections
  Object.keys(CONFIG.products).forEach(productName => {
    renderSection(c,`Product: ${productName}`, CONFIG.products[productName], false);
  });

  // Hypercare
  renderSection(c,"UAT and Migration , Hypercare",CONFIG.hypercare,false);
}

// Initial render
renderSelector();
rebuildProductConfig();
renderEstimation();

/* =========================
   ADMIN MODE
========================= */

function checkAdminPassword(){
  if(prompt("Enter admin password")==="admin123"){
    activateTab("admin");
    renderAdmin();
  } else {
    alert("Incorrect password");
  }
}

function renderAdmin(){
  const c=document.getElementById("adminContainer");
  c.innerHTML="<h3>Admin Mode (Editable)</h3>";
  renderSection(c,"Overview",CONFIG.overview,true);

  Object.keys(CONFIG.products).forEach(productName => {
    renderSection(c,`Product: ${productName}`, CONFIG.products[productName], true);
  });

  renderSection(c,"UAT and Migration , Hypercare",CONFIG.hypercare,true);
}

function updateTask(section,idx,field,value){
  value = field==='qty' ? (parseInt(value)||0) : (parseFloat(value)||0);
  if(section==="Overview") {
    CONFIG.overview[idx][field]=value;
  } else if(section==="UAT and Migration , Hypercare") {
    CONFIG.hypercare[idx][field]=value;
  } else if(section.startsWith("Product: ")) {
    const productName = section.replace("Product: ", "");
    CONFIG.products[productName][idx][field] = value;
  }
  renderEstimation();
}

/* =========================
   EXPORT
========================= */

function downloadAll(){
  const wb=XLSX.utils.book_new();
  const rows=[["Section","Task","Details","Non-Prod","Prod","Qty","Total","CSU"]];

  // Overview
  CONFIG.overview.forEach(t=>{
    const tot=(t.nonProd+t.prod)*t.qty;
    rows.push(["Overview",t.name,t.detail,t.nonProd,t.prod,t.qty,tot,tot/2]);
  });

  // Products
  Object.entries(CONFIG.products).forEach(([prodName, tasks])=>{
    tasks.forEach(t=>{
      const tot=(t.nonProd+t.prod)*t.qty;
      rows.push([`Product: ${prodName}`,t.name,t.detail,t.nonProd,t.prod,t.qty,tot,tot/2]);
    });
  });

  // Hypercare
  CONFIG.hypercare.forEach(t=>{
    const tot=(t.nonProd+t.prod)*t.qty;
    rows.push(["Hypercare",t.name,t.detail,t.nonProd,t.prod,t.qty,tot,tot/2]);
  });

  XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(rows),"Estimation");
  XLSX.writeFile(wb,"Redwood_Adoption_Estimation_Final.xlsx");
}
</script>

</body>
</html>

